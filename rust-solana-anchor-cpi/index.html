<!DOCTYPE html>
<html lang="en">

<head>
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
    <title>dev_stories</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="robots" content="noodp"/>

    <link rel="stylesheet" href="https://maltsev-dev.github.io/style.css">
    <link rel="stylesheet" href="https://maltsev-dev.github.io/color/orange.css">

        <link rel="stylesheet" href="https://maltsev-dev.github.io/color/background_blue.css">
    
    <link rel="stylesheet" href="https://maltsev-dev.github.io/font-quicksand.css">


    
        <link rel="shortcut icon" type="image/png" href="/favicon.png">
    
    <meta property="og:site_name" content="dev_stories"><meta property="og:type" content="article">
    <meta property="og:title" content="üîó Anchor CPI ‚Äì Cross-Program Invocation on Solana"><meta property="og:url" content="https://maltsev-dev.github.io/rust-solana-anchor-cpi/"><meta property="og:image" content="https://github.com/maltsev-dev/favicon.png">

    </head>

<body class="">
<div class="container">
    
    <header class="header">
        <div class="header__inner">
            <div class="header__logo">
                    
                <a href="https://maltsev-dev.github.io" style="text-decoration: none;">
                    <div class="logo">
                      
                            busy hands == happy heart
                        
                    </div>
                </a>
            </div>
        </div>

        
        <nav class="menu">
            <ul class="menu__inner">
                <li><a href="https://maltsev-dev.github.io/archive">archive</a></li>
            
                <li><a href="https://maltsev-dev.github.io/tags/project/">projects</a></li>
            
                <li><a href="https://maltsev-dev.github.io/tags/embedded/">embedded</a></li>
            
                <li><a href="https://maltsev-dev.github.io/tags/rust/">rust</a></li>
            
                <li><a href="https://maltsev-dev.github.io/about">about</a></li>
            </ul>
        </nav>
    
    
        
    </header>
    

    <div class="content">
        
    <div class="post">
        
    <h1 class="post-title"><a href="https://maltsev-dev.github.io/rust-solana-anchor-cpi/">üîó Anchor CPI ‚Äì Cross-Program Invocation on Solana</a></h1>
    <div class="post-meta-inline">
        
    <span class="post-date">
            2025-03-19
        </span>

    </div>

    
        <span class="post-tags-inline">
                :: tags:&nbsp;
                <a class="post-tag" href="https://maltsev-dev.github.io/tags/rust/">#rust</a>&nbsp;
                <a class="post-tag" href="https://maltsev-dev.github.io/tags/solana/">#solana</a>&nbsp;
                <a class="post-tag" href="https://maltsev-dev.github.io/tags/anchor/">#anchor</a>&nbsp;
                <a class="post-tag" href="https://maltsev-dev.github.io/tags/project/">#project</a></span>
    

        
        <div class="post-content">
            <p><strong>A working example of Anchor-based CPI (Cross Program Invocation) ‚Äî when one Solana program calls another.</strong>
This project demonstrates best practices for inter-program communication using the Anchor framework.</p>
<span id="continue-reading"></span>
<hr />
<p><a href="https://github.com/maltsev-dev/anchor_cpi">üìö GitHub Repository</a></p>
<p>This project illustrates how to structure two Solana programs (<code>program-a</code> and <code>program-b</code>) where <strong>Program A</strong> performs a CPI to <strong>Program B</strong>, and also interacts with <strong>System Program</strong> (for SOL transfers).</p>
<p>CPI (Cross-Program Invocation) is a critical building block for modular, reusable smart contracts on Solana. This example is ideal for:</p>
<ul>
<li>Developers learning advanced Solana development</li>
<li>Those building protocol layers or modular dApps</li>
<li>Projects where multiple programs need to coordinate actions</li>
</ul>
<hr />
<h2 id="wrench-stack-tools">üîß Stack &amp; Tools</h2>
<ul>
<li>ü¶Ä <strong>Rust</strong> ‚Äî primary language</li>
<li>‚öì <strong>Anchor</strong> ‚Äî Solana framework</li>
<li>üîÅ <strong>CPI Pattern</strong></li>
<li>üîç <strong>Transaction Explorer</strong></li>
<li>üß™ <strong>Anchor tests with local validator</strong></li>
</ul>
<hr />
<h2 id="sparkles-features">‚ú® Features</h2>
<ol>
<li>
<p><strong>Call Another Program from Your Program</strong></p>
<ul>
<li>CPI pattern with <code>invoke_signed()</code> in Anchor</li>
</ul>
</li>
<li>
<p><strong>Pass Accounts &amp; Instruction Data</strong></p>
<ul>
<li>Structured instruction building for inner program calls</li>
</ul>
</li>
<li>
<p><strong>Work with System Program</strong></p>
<ul>
<li>Demonstrates how to invoke built-in programs (e.g., SOL transfers)</li>
</ul>
</li>
<li>
<p><strong>Observe Execution Flow</strong></p>
<ul>
<li>View log output to understand program interaction sequence</li>
</ul>
</li>
</ol>
<hr />
<h2 id="rocket-setup-usage">üöÄ Setup &amp; Usage</h2>
<h3 id="1-construction-site-initialize-projects">1. üèóÔ∏è Initialize Projects</h3>
<p>Create two Anchor programs:</p>
<pre data-lang="bash" style="background-color:#151515;color:#e8e8d3;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffb964;">anchor</span><span> init program-a
</span><span>cd ..
</span><span style="color:#ffb964;">anchor</span><span> init program-b
</span></code></pre>
<h3 id="2-repeat-configure-dependencies">2. üîÅ Configure Dependencies</h3>
<p>In <code>Cargo.toml</code> of <code>program-a</code>, add:</p>
<pre data-lang="toml" style="background-color:#151515;color:#e8e8d3;" class="language-toml "><code class="language-toml" data-lang="toml"><span style="color:#ffb964;">program-b </span><span>= { </span><span style="color:#ffb964;">path </span><span>= </span><span style="color:#556633;">&quot;</span><span style="color:#99ad6a;">../program-b</span><span style="color:#556633;">&quot;</span><span>, </span><span style="color:#ffb964;">features </span><span>= [</span><span style="color:#556633;">&quot;</span><span style="color:#99ad6a;">cpi</span><span style="color:#556633;">&quot;</span><span>] }
</span></code></pre>
<p>In <code>Anchor.toml</code> of <code>program-a</code>, disable auto-resolution of dependencies:</p>
<pre data-lang="toml" style="background-color:#151515;color:#e8e8d3;" class="language-toml "><code class="language-toml" data-lang="toml"><span>[</span><span style="color:#ffb964;">programs</span><span>.</span><span style="color:#ffb964;">localnet</span><span>]
</span><span style="color:#ffb964;">program_b </span><span>= </span><span style="color:#556633;">&quot;</span><span style="color:#99ad6a;">...</span><span style="color:#556633;">&quot; </span><span style="color:#888888;"># Your local key
</span><span>
</span><span>[</span><span style="color:#ffb964;">workspace</span><span>.</span><span style="color:#ffb964;">dependencies</span><span>]
</span><span style="color:#ffb964;">program-b </span><span>= { </span><span style="color:#ffb964;">path </span><span>= </span><span style="color:#556633;">&quot;</span><span style="color:#99ad6a;">../program-b</span><span style="color:#556633;">&quot;</span><span>, </span><span style="color:#ffb964;">features </span><span>= [</span><span style="color:#556633;">&quot;</span><span style="color:#99ad6a;">cpi</span><span style="color:#556633;">&quot;</span><span>], </span><span style="color:#ffb964;">resolution </span><span>= false }
</span></code></pre>
<hr />
<h3 id="3-test-tube-run-tests">3. üß™ Run Tests</h3>
<p>Build and test CPI interaction:</p>
<pre data-lang="bash" style="background-color:#151515;color:#e8e8d3;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffb964;">anchor</span><span> build &amp;&amp; </span><span style="color:#ffb964;">anchor</span><span> test
</span></code></pre>
<hr />
<h3 id="4-bricks-start-local-validator">4. üß± Start Local Validator</h3>
<pre data-lang="bash" style="background-color:#151515;color:#e8e8d3;" class="language-bash "><code class="language-bash" data-lang="bash"><span>cd .anchor/
</span><span style="color:#ffb964;">solana-test-validator
</span></code></pre>
<hr />
<h3 id="5-mag-view-transactions">5. üîç View Transactions</h3>
<ol>
<li>Open <a href="https://explorer.solana.com">explorer.solana.com</a></li>
<li>Switch to "Localhost" network</li>
<li>Find your transaction signature in test output logs</li>
</ol>
<hr />
<h2 id="desktop-sample-logs">üñ•Ô∏è Sample Logs</h2>
<pre data-lang="bash" style="background-color:#151515;color:#e8e8d3;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffb964;">Program</span><span> logged: </span><span style="color:#556633;">&quot;</span><span style="color:#99ad6a;">Instruction: Initialize</span><span style="color:#556633;">&quot;
</span><span style="color:#ffb964;">Program</span><span> logged: </span><span style="color:#556633;">&quot;</span><span style="color:#99ad6a;">Greetings from: Program A</span><span style="color:#556633;">&quot;
</span><span style="color:#ffb964;">Program</span><span> invoked: System Program
</span><span style="color:#ffb964;">Program</span><span> returned success
</span><span style="color:#ffb964;">Program</span><span> invoked: Unknown Program (...)
</span><span style="color:#ffb964;">Program</span><span> logged: </span><span style="color:#556633;">&quot;</span><span style="color:#99ad6a;">Instruction: Initialize</span><span style="color:#556633;">&quot;
</span><span style="color:#ffb964;">Program</span><span> logged: </span><span style="color:#556633;">&quot;</span><span style="color:#99ad6a;">Greetings from: Program B</span><span style="color:#556633;">&quot;
</span><span style="color:#ffb964;">Program</span><span> consumed: 676 of 190087 compute units
</span><span style="color:#ffb964;">Program</span><span> returned success
</span></code></pre>
<p>These logs show:</p>
<ul>
<li>Instruction flow through both programs</li>
<li>System-level interaction</li>
<li>Success/failure of each step</li>
</ul>
<hr />
<h2 id="page-facing-up-license">üìÑ License</h2>
<p>This project is licensed under the <strong>MIT License</strong> ‚Äî free to use, modify, and extend.</p>

        </div>

        
        <div class="pagination">
            <div class="pagination__title">
                <span class="pagination__title-h">Read other posts?</span>
                <hr />
            </div>
            <div class="pagination__buttons">
                    <span class="button previous">
                        <a href="https://maltsev-dev.github.io/rust-solana-anchor/">
                            <span class="button__icon">‚Üê</span>&nbsp;
                            <span class="button__text">üéÆ Game on Solana: Guess the Number</span>
                        </a>
                    </span>
                
                
                    <span class="button next">
                        <a href="https://maltsev-dev.github.io/rust-solana-anchor-favorites/">
                            <span class="button__text">üì¶ On-Chain Key-Value Storage</span>&nbsp;
                            <span class="button__icon">‚Üí</span>
                        </a>
                    </span>
                </div>
        </div>
    
    </div>

    </div>


<footer class="footer">
    <div class="footer__inner">
            <div class="copyright copyright--user"><div class="copyright">
    <span>¬© 2025 A.Maltsev</span>
    <span class="copyright-theme-sep"> | </span>
    <span><img src="https://visitor-badge.laobi.icu/badge?page_id=maltsev-dev.github.io&right_color=orange" alt="Visitors"></span>
</div>
</div>
        </div>
</footer>


</div>
</body>

</html>