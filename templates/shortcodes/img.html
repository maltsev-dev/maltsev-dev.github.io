{% set is_jpeg = src is ending_with(".jpg") or src is ending_with(".jpeg") %}
{% set is_gif = src is ending_with(".gif") %}

{% if is_gif %}
    {% set image_thumb = resize_image(path=src, width=360, height=360, op="fit") %}
    {% set image_full = resize_image(path=src, width=1920, height=1920, op="fit") %}
{% elif is_jpeg %}
    {% set image_thumb = resize_image(path=src, width=360, height=360, op="fit", format="webp") %}
    {% set image_full = resize_image(path=src, width=1920, height=1920, op="fit") %}
{% else %}
    {% set image_thumb = resize_image(path=src, width=360, height=360, op="fit", format="webp") %}
    {% set image_full = resize_image(path=src, width=1920, height=1920, op="fit", format="webp") %}
{% endif %}

{% if src %}
<figure class="{{ position or "center" }}">
    <a href="{{ image_full.url | safe }}">
        <img src="{{ image_thumb.url | safe }}"
             {% if alt %} alt="{{ alt }}" {% endif %}
             {% if style %} style="{{ style }}" {% endif %} />
    </a>
    {% if caption %}
    <figcaption class="{{ caption_position or "center" }}"
                {% if caption_style %} style="{{ caption_style | safe }}" {% endif %}>
        {{ caption }}
    </figcaption>
    {% endif %}
</figure>
{% endif %}
